---
title: "9:10:53 PM - December 19, 2025"
date: 2025-12-19T08:10:53.891Z
timestamp: 1766131853891
---

## Project Notes

Fixed critical audio issue in VideoExportService clip concatenation:

**Problem**: The FFmpeg filter_complex was using `anullsrc` (silent audio generator) for ALL clips instead of using the actual audio streams from the input files. This caused recorded audio to be lost during concatenation.

**Root Cause**: Code at lines 184-188 was always using:
```
anullsrc=channel_layout=mono:sample_rate=48000:d=$durationSec[silence$i]
```
instead of using `[$i:a]` (actual audio from input).

**Fix**: 
1. Changed to use actual audio streams: `[${i}:a]asetpts=PTS-STARTPTS[a$i]`
2. Added fallback mechanism - if clips lack audio (very short clips), catches the FFmpegEncoderException and retries with `anullsrc`

**Key Pattern**: Try real audio first, fall back to synthetic silence only if necessary. This preserves recorded audio while still handling edge cases.

**Also Fixed**: Navigation hang from ClipManager to VideoEditor - used `WidgetsBinding.instance.addPostFrameCallback` to ensure context.push() happens after the current frame completes. The issue was that BuildContext could become stale after setState during async operations.
