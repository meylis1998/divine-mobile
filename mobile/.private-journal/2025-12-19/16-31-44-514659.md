---
title: "4:31:44 PM - December 19, 2025"
date: 2025-12-19T03:31:44.514Z
timestamp: 1766115104514
---

## Project Notes

**Critical Database Migration Pattern Discovered**

The `event` table is created by nostr_sdk (embedded relay) but db_client extends it with additional columns like `expire_at`. This creates a tricky migration scenario:

1. nostr_sdk creates `event` table WITHOUT `expire_at`
2. db_client's Drift definition EXPECTS `expire_at`
3. Standard Drift migrations don't work because nostr_sdk controls table creation

**Solution**: Added `_ensureEventTableColumns()` that:
- Runs in `beforeOpen` before any cleanup
- Uses `PRAGMA table_info(event)` to check column existence
- Adds missing columns via `ALTER TABLE event ADD COLUMN`
- Creates associated indexes

This pattern will be needed for any future columns db_client needs on shared tables.
