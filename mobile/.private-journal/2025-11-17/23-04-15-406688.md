---
title: "11:04:15 PM - November 17, 2025"
date: 2025-11-18T07:04:15.406Z
timestamp: 1763449455406
---

## Project Notes

**Profile Refresh Issue - Root Cause and Fix**

**Problem**: After editing profile, the ProfileScreenRouter doesn't refresh to show updated information.

**Root Cause**: State management timing issue in Riverpod provider lifecycle:
1. ProfileSetupScreen updates cache and invalidates provider BEFORE navigating back
2. When Navigator.pop() returns to ProfileScreenRouter, it reveals the existing widget without triggering a rebuild
3. The invalidated provider doesn't rebuild because the watching widget (ProfileScreenRouter) isn't actively rebuilding

**Solution**: Invalidate the profile provider AFTER returning from the edit screen:
- In `_editProfile()`: After `await context.push('/edit-profile')` returns, invalidate `fetchUserProfileProvider`
- In `_setupProfile()`: After `await context.push('/setup-profile')` returns, invalidate `fetchUserProfileProvider`

**Key Insight**: When using `context.push()`, it awaits the navigation return. At that point, the widget IS active and listening, so invalidating the provider triggers an immediate rebuild with fresh data from the updated cache.

**Files Modified**:
- `lib/screens/profile_screen_router.dart:1323-1336` - Added refresh after _setupProfile
- `lib/screens/profile_screen_router.dart:1369-1384` - Added refresh after _editProfile

**Pattern to Remember**: For profile/data updates that happen in pushed screens:
1. Update data in the pushed screen
2. Invalidate provider from pushed screen (keeps cache in sync)
3. ALSO invalidate provider after returning to the original screen (triggers UI rebuild)

