{
  "embedding": [
    -0.05206061899662018,
    0.00933129619807005,
    -0.004724697209894657,
    -0.01984146609902382,
    0.027207138016819954,
    -0.002713959664106369,
    0.017154395580291748,
    -0.058605700731277466,
    -0.03505168482661247,
    0.0270541999489069,
    0.01237877644598484,
    0.024057211354374886,
    0.002335602417588234,
    0.039206720888614655,
    -0.0403047539293766,
    -0.023605359718203545,
    0.07606984674930573,
    -0.06516343355178833,
    -0.08125963807106018,
    0.005868974141776562,
    0.003722078399732709,
    -0.00526183657348156,
    0.037220533937215805,
    0.04461514204740524,
    -0.015623322688043118,
    -0.00870139803737402,
    -0.05909689515829086,
    -0.10524477809667587,
    -0.02154778130352497,
    -0.014995870180428028,
    0.043086886405944824,
    0.026569347828626633,
    -0.137999027967453,
    -0.0632995069026947,
    0.0019024695502594113,
    0.06287477165460587,
    -0.06888977438211441,
    0.008297315798699856,
    -0.07053516060113907,
    -0.015037876553833485,
    0.03979490324854851,
    -0.01569640450179577,
    -0.10698603838682175,
    0.013994249515235424,
    0.007484266068786383,
    -0.00523608922958374,
    -0.013555344194173813,
    -0.0437595471739769,
    -0.003782992484048009,
    0.02051514759659767,
    -0.020637761801481247,
    -0.0009404330048710108,
    -0.001731881988234818,
    0.02241172455251217,
    0.0440848171710968,
    0.007455240003764629,
    0.010467378422617912,
    0.0526091568171978,
    -0.05465313419699669,
    0.036968205124139786,
    -0.01529775932431221,
    0.0024135219864547253,
    0.00716976635158062,
    -0.04969615861773491,
    0.0011711554834619164,
    0.0035305859055370092,
    0.07523320615291595,
    0.03758060559630394,
    0.12531480193138123,
    -0.03764412924647331,
    -0.02217947691679001,
    0.10203790664672852,
    0.03213648498058319,
    0.015793513506650925,
    -0.03577019274234772,
    -0.02510647475719452,
    0.027754299342632294,
    0.003597540780901909,
    0.021396245807409286,
    -0.11976084113121033,
    -0.053244322538375854,
    -0.035544902086257935,
    0.04739956557750702,
    -0.017514878883957863,
    0.03693082928657532,
    0.029582014307379723,
    0.01788412220776081,
    -0.049754828214645386,
    0.04982171207666397,
    0.019170010462403297,
    0.04120873659849167,
    0.08155518025159836,
    0.0011428684229031205,
    -0.02446347288787365,
    0.10269619524478912,
    -0.038351647555828094,
    0.0052353632636368275,
    0.02562521956861019,
    -0.03003739006817341,
    0.028647247701883316,
    0.030559144914150238,
    0.024225885048508644,
    0.030389120802283287,
    0.1227516233921051,
    0.08954016864299774,
    -0.05945103242993355,
    0.0018834627699106932,
    -0.009602604433894157,
    -0.00490108085796237,
    0.016302600502967834,
    0.037716299295425415,
    -0.016016753390431404,
    0.060401055961847305,
    0.03273536264896393,
    -0.0021561579778790474,
    0.04281299561262131,
    -0.09426608681678772,
    0.0056432876735925674,
    0.01556073222309351,
    0.07699999213218689,
    0.07013065367937088,
    0.004138306714594364,
    0.07450549304485321,
    -0.043653860688209534,
    -0.01617816835641861,
    0.049760982394218445,
    0.059469010680913925,
    5.572580845602784e-33,
    0.001125795068219304,
    -0.11955263465642929,
    -0.06202726066112518,
    0.09559046477079391,
    -0.04976945370435715,
    -0.03349579498171806,
    -0.04508943110704422,
    0.042531516402959824,
    -0.012637296691536903,
    -0.08914097398519516,
    0.019191592931747437,
    -0.01439200434833765,
    -0.06471138447523117,
    -0.026417698711156845,
    0.05955014005303383,
    -0.058139700442552567,
    0.011712524108588696,
    0.028724364936351776,
    0.07003642618656158,
    0.0038009255658835173,
    0.06930828094482422,
    -0.010522764176130295,
    -0.0861794725060463,
    -0.0924806073307991,
    -0.007185453083366156,
    -0.02152511291205883,
    0.050671447068452835,
    0.05288712680339813,
    -0.02759244292974472,
    0.02817821316421032,
    0.023079171776771545,
    -0.008129622787237167,
    -0.005577252712100744,
    0.008315151557326317,
    -0.053308602422475815,
    -0.06756800413131714,
    -0.03144063800573349,
    -0.014814851805567741,
    -0.08117697387933731,
    -0.12272541970014572,
    -0.001934151048772037,
    0.010831935331225395,
    -0.07057637721300125,
    -0.0017794433515518904,
    -0.0036958665587008,
    -0.1856842339038849,
    0.029610419645905495,
    0.02477238141000271,
    0.01334686204791069,
    0.046349719166755676,
    0.027443524450063705,
    0.018497657030820847,
    -0.04143169894814491,
    -0.05743757635354996,
    -0.09798974543809891,
    0.05846240743994713,
    0.03438771516084671,
    -0.04277722164988518,
    -0.021349551156163216,
    -0.062055520713329315,
    -0.015313124284148216,
    -0.06068327650427818,
    -0.055299777537584305,
    0.00011657658615149558,
    0.04898005723953247,
    0.06964167952537537,
    0.004974262788891792,
    -0.03298724815249443,
    0.003913430497050285,
    -0.02833661250770092,
    -0.07849273085594177,
    -0.06293943524360657,
    0.03913434222340584,
    0.0033209470566362143,
    -0.005237693898379803,
    -0.005658688955008984,
    0.01810563914477825,
    -0.032375186681747437,
    -0.16544802486896515,
    -0.0641741007566452,
    0.08034241199493408,
    -0.030801285058259964,
    -0.04733722656965256,
    0.05248956009745598,
    -0.005598912481218576,
    -0.0551891028881073,
    0.08197453618049622,
    -0.10055021196603775,
    -0.03661474958062172,
    0.07286618649959564,
    0.0623629204928875,
    0.007483253255486488,
    0.04530929774045944,
    -0.011534317396581173,
    0.023536724969744682,
    -6.44343187641406e-33,
    -0.0018509303918108344,
    -0.027462679892778397,
    -0.06980448961257935,
    0.06988794356584549,
    0.07891594618558884,
    -0.07057999819517136,
    -0.01873830333352089,
    0.03786512836813927,
    -0.04367765039205551,
    -0.11206524819135666,
    -0.08305956423282623,
    0.02682667411863804,
    -0.02204272150993347,
    0.050724755972623825,
    -0.08984216302633286,
    0.047251246869564056,
    0.016286073252558708,
    -0.021225128322839737,
    0.007124653086066246,
    0.0039055664092302322,
    -0.0027204554062336683,
    0.08852817118167877,
    0.09586237370967865,
    -0.026214314624667168,
    -0.03653967007994652,
    0.060640137642621994,
    0.004819439258426428,
    -0.004575873259454966,
    0.029117334634065628,
    -0.0797262191772461,
    0.12188146263360977,
    -0.04036138951778412,
    -0.03433386608958244,
    0.038010623306035995,
    -0.023031923919916153,
    -0.03876081109046936,
    0.02526036836206913,
    -0.03570174053311348,
    -0.0807461366057396,
    0.030335906893014908,
    0.16205069422721863,
    0.0006930512608960271,
    -0.07061626762151718,
    -0.044123679399490356,
    -0.005218955222517252,
    0.0187302865087986,
    0.029657438397407532,
    0.017206190153956413,
    -0.0314566008746624,
    -0.01293947920203209,
    0.023548895493149757,
    -0.03485488519072533,
    0.0023556817322969437,
    0.03855830058455467,
    0.0019893967546522617,
    0.017711175605654716,
    0.1122165322303772,
    0.02593742124736309,
    -0.006814699154347181,
    -0.02226504497230053,
    0.09742900729179382,
    -0.0398721806704998,
    -0.04594014957547188,
    0.018811851739883423,
    0.002433182904496789,
    -0.01113948505371809,
    0.06085285171866417,
    0.0710550919175148,
    0.03094547614455223,
    0.02918386086821556,
    0.04638070613145828,
    0.04147118330001831,
    -0.027837546542286873,
    -0.045751459896564484,
    0.06601212918758392,
    0.01814507506787777,
    -0.012739491648972034,
    -0.04534679278731346,
    -0.009654155001044273,
    -0.04838863015174866,
    -0.11639783531427383,
    0.005601575598120689,
    -0.01854601874947548,
    -0.04721676558256149,
    -0.04319923371076584,
    -0.030772455036640167,
    -0.001922493684105575,
    0.016161859035491943,
    0.05060398578643799,
    0.0358632355928421,
    -0.003475007601082325,
    -0.07150516659021378,
    -0.12013741582632065,
    0.021815313026309013,
    -0.020505070686340332,
    -5.670841218829992e-8,
    -0.020236851647496223,
    0.044909995049238205,
    -0.03566095605492592,
    0.10172594338655472,
    0.03767785057425499,
    -0.12848453223705292,
    0.09431304782629013,
    0.02303490974009037,
    0.027186274528503418,
    0.026836542412638664,
    0.022856123745441437,
    0.009830335155129433,
    -0.037155117839574814,
    -0.0757049024105072,
    0.06281516700983047,
    -0.044564832001924515,
    0.008593513630330563,
    -0.03025692328810692,
    -0.0790417417883873,
    -0.047848302870988846,
    -0.02498214691877365,
    -0.029403625056147575,
    -0.03578326106071472,
    0.018343990668654442,
    -0.08093593269586563,
    0.012163903564214706,
    0.12191438674926758,
    0.0670974999666214,
    0.05154301971197128,
    -0.004175043199211359,
    -0.021976064890623093,
    0.015407964587211609,
    0.07034754008054733,
    -0.07452350854873657,
    -0.07345536351203918,
    0.08199816942214966,
    0.006891578435897827,
    0.04720363765954971,
    0.07975773513317108,
    0.10588129609823227,
    -0.003904700046405196,
    0.021454669535160065,
    0.009244284592568874,
    0.017780182883143425,
    0.03181956335902214,
    0.0123654305934906,
    -0.0017339956248179078,
    -0.003300884971395135,
    0.018778102472424507,
    -0.0414603166282177,
    -0.06304846704006195,
    0.03225615620613098,
    -0.02378317154943943,
    0.03827134147286415,
    0.02850421518087387,
    0.0056246365420520306,
    0.03731074184179306,
    -0.040868133306503296,
    0.04058288037776947,
    0.042071450501680374,
    0.058350563049316406,
    -0.009193205274641514,
    0.03628028184175491,
    -0.002933098003268242
  ],
  "text": "### Root Cause\nThe `ageVerificationServiceProvider` was configured as autoDispose, causing it to be disposed when widgets stopped watching it. When recreated, the service's in-memory `_isAdultContentVerified` state was lost (null, defaulting to false) until `initialize()` completed loading from SharedPreferences. But `initialize()` was NOT awaited, creating a race condition where checks happened before state was loaded.\n\n### Fix\nChanged from `@riverpod` to `@Riverpod(keepAlive: true)` in `lib/providers/app_providers.dart`:\n```dart\n@Riverpod(keepAlive: true)\nAgeVerificationService ageVerificationService(Ref ref) {\n  final service = AgeVerificationService();\n  service.initialize(); // Initialize asynchronously\n  return service;\n}\n```\n\n### Key Insight\nThe `keepAlive: true` annotation prevents automatic disposal when no widgets are watching, ensuring the singleton persists for the app's lifetime. This means the in-memory verification state is preserved after user verifies their age.\n\n### Testing Lesson\n`container.invalidate()` forces provider recomputation regardless of keepAlive - it tests different behavior than autoDispose. To test keepAlive vs autoDispose, test that multiple reads return the same instance and state persists.\n\n### Files Modified\n- `lib/providers/app_providers.dart` - Added keepAlive: true to ageVerificationServiceProvider\n- `lib/providers/app_providers.g.dart` - Regenerated with isAutoDispose: false\n- `lib/widgets/video_error_overlay.dart` - Added diagnostic logging for age-gate flow\n- `lib/providers/individual_video_providers.dart` - Added logging to _computeAuthHeadersSync\n- `test/providers/age_verification_provider_test.dart` - New test file for provider behavior",
  "sections": [
    "Project Notes",
    "Age-Gate Bug Fix (2025-12-02)"
  ],
  "timestamp": 1764624253840,
  "path": "/Users/rabble/code/andotherstuff/openvine/mobile/.private-journal/2025-12-02/10-24-13-840165.md"
}