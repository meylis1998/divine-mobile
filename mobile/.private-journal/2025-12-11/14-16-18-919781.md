---
title: "2:16:18 PM - December 11, 2025"
date: 2025-12-11T01:16:18.919Z
timestamp: 1765415778919
---

## Project Notes

**Relay Connection Issues Investigation (2025-12-11)**

User reported two related issues:
1. App loads on iOS, gets videos but shows "no relays"
2. "Restore Default Relay" button says it fails but actually works

**Root Cause Analysis:**

**Issue 1: Misleading "restore default" error**
The `addRelay()` method in nostr_service.dart (line 1273-1278) returns `false` when the relay is already in `_configuredRelays`:
```dart
if (_configuredRelays.contains(relayUrl)) {
  return false; // Already added
}
```

When user clicks "Restore Default Relay":
- The relay IS already in `_configuredRelays` (loaded from SharedPreferences)
- So `addRelay()` returns `false`
- The UI shows error: "Failed to restore default relay"
- But the relay WAS there the whole time - so functionally it "worked"

This is semantically incorrect - having the relay already configured is a success, not a failure.

**Issue 2: Connection hanging during initialization**
Looking at the logs:
```
[14:10:33.381] [RELAY] üîå Connecting to external relay: wss://relay.divine.video
```
After this line, there's NO success or failure log. The expected logs would be either:
- `‚úÖ External relay connected: wss://relay.divine.video (XXms)`
- `‚ùå External relay FAILED to connect: wss://relay.divine.video`

The connection to `wss://relay.divine.video` is silently failing or hanging. The `addExternalRelay()` call on the embedded relay isn't throwing but also isn't successfully connecting.

**Fix for Issue 1:**
Change `addRelay()` to return `true` when relay is already configured, and try to reconnect it if not connected.

**Investigation needed for Issue 2:**
Need to look at why the embedded relay's connection to wss://relay.divine.video is hanging.
