---
title: "12:32:18 AM - December 14, 2025"
date: 2025-12-13T11:32:18.304Z
timestamp: 1765625538304
---

## Project Notes

## OpenVine Recording & Publishing Flow Analysis

### Key Findings:

**Recording Segments Storage:**
1. `VineRecordingController` maintains `List<RecordingSegment>` internally
2. Each segment has: filePath, duration, and virtual tracking for macOS
3. Provider wrapper: `VineRecordingNotifier` in `vine_recording_provider.dart` exposes segments via `segments` getter
4. Segments are in-memory only during recording session

**Clips Management (Multi-segment recording):**
1. `ClipManagerService` maintains separate `List<RecordingClip>` for explicit clip management
2. Used when user records multiple clips and wants to manage them individually
3. Each clip: id, filePath, duration, orderIndex, recordedAt, thumbnailPath
4. **Key method:** `clearAll()` in ClipManagerService (line 94-98) - completely empties clips list

**Post-Publish Cleanup:**
1. In `VideoMetadataScreenPure._publishVideo()` (line 1180):
   - SUCCESS: `draftService.deleteDraft(_currentDraft!.id)` - removes draft from storage
   - THEN: `ref.read(vineRecordingProvider.notifier).markAsPublished()` - sets `_wasPublished = true` flag
   - This prevents auto-save on dispose

2. Current flow after publish:
   - Navigates to profile screen (line 1203): `context.goMyProfile()`
   - NO cleanup of recording segments or temp files

**Draft Management:**
- `DraftStorageService` uses SharedPreferences to persist drafts
- Drafts contain: videoFile, title, description, hashtags, proofManifestJson
- When publishing succeeds, draft is deleted
- Auto-save on dispose if publishing was not marked successful

**Existing Reset/Cleanup:**
1. `VineRecordingNotifier.reset()` (line 337-342):
   - Calls `_controller.reset()`
   - Resets `_wasPublished = false`
   - Clears `_currentDraftId = null`

2. `VineRecordingNotifier.cleanupAndReset()` (line 355-376):
   - Calls `_controller.cleanupFiles()` - deletes temp files
   - Calls `_controller.reset()` - resets state
   - Clears flags

3. Called when entering camera screen fresh (line 219 in universal_camera_screen_pure.dart)

**GAP IDENTIFIED:**
After publishing succeeds, the code does NOT call any cleanup:
- Recording segments remain in memory
- Temp video files may remain on disk
- Clip manager state is not cleared if user was using it
- No explicit cleanup before navigating away

**Where cleanup SHOULD happen:**
Either:
1. After successful publish, before navigation
2. In screen dispose when coming from publish flow
3. Combined in a dedicated "complete publish workflow" method

**State tracking after publish:**
- Draft is deleted from SharedPreferences ✓
- `_wasPublished` flag set to prevent auto-save ✓
- Recording provider marked as published ✓
- BUT: Segments, temp files, and clips still exist ✗

