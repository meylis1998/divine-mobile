---
title: "7:33:29 AM - December 12, 2025"
date: 2025-12-11T18:33:29.566Z
timestamp: 1765478009566
---

## Project Notes

## Video Player Crash Fix - "No active player with ID"

**Root Cause**: Race condition in video controller lifecycle. When user scrolls quickly through feed:
1. Provider disposal triggers `ref.onDispose()` which uses `Future.microtask` to defer native disposal
2. But async callbacks (like `.then()` on play/pause) still hold controller references
3. When callback executes, native AVFoundation player is already gone
4. CRASH: "Bad state: No active player with ID 13"

**Fix Implemented**:
1. Added `safePlay()`, `safePause()`, `safeSeekTo()` helpers in `individual_video_providers.dart`
2. These wrap controller operations in try-catch that detects disposal errors:
   - "no active player"
   - "bad state"
   - "disposed"
   - "player with id"
3. Updated all play/pause calls in `video_feed_item.dart` to use safe wrappers
4. Added `isInitialized` checks before operations

**Files Modified**:
- `lib/providers/individual_video_providers.dart` - Added safe* helper functions
- `lib/widgets/video_feed_item.dart` - Updated all controller.play()/pause() calls

**Test Coverage**:
- Created `test/providers/safe_controller_operations_test.dart` with 14 tests
- Tests verify: uninitialized handling, success cases, disposal error catching, error rethrow
