---
title: "7:24:22 PM - November 13, 2025"
date: 2025-11-13T19:24:22.840Z
timestamp: 1763061862840
---

## Project Notes

**Age Gate Issue Investigation - Phase 1 Complete**

Found the welcome screen logic in `mobile/lib/screens/welcome_screen.dart`. The button visibility is controlled by:
1. Lines 88-94: Shows loading spinner if `authState == AuthState.checking || AuthState.authenticating`
2. Lines 95-128: Shows Continue button if `isAuthenticated` (i.e., `authState == AuthState.authenticated`)
3. Lines 129-174: Shows error if `!isAuthenticated`

**CRITICAL DISCOVERY**: AuthService was refactored from ChangeNotifier to use StreamControllers (line 80 comment confirms this). The WelcomeScreen uses `ref.watch(authServiceProvider)` which watches the provider, not the auth state stream.

**The race condition mechanism**: 
- AuthService uses StreamController for state changes (lines 92-95)
- Provider is `@Riverpod(keepAlive: true)` returning AuthService instance
- When auth state changes, StreamController emits but Riverpod doesn't rebuild because the AuthService instance hasn't changed
- If auth completes before WelcomeScreen builds, the screen shows the old state and never updates

Next: Verify if there's a proper stream provider for auth state that should be used instead.
