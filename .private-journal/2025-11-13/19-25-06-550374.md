---
title: "7:25:06 PM - November 13, 2025"
date: 2025-11-13T19:25:06.550Z
timestamp: 1763061906550
---

## Project Notes

**Age Gate Issue - Phase 2 Complete**

**Root Cause Identified:**

The WelcomeScreen (line 29-30) uses:
```dart
final authService = ref.watch(authServiceProvider);
final authState = authService.authState;
```

This watches the **AuthService instance** (provider), not the **auth state**. When `_setAuthState()` is called in auth_service.dart (lines 587-594), it only emits to StreamController - the AuthService instance itself doesn't change, so Riverpod doesn't trigger a rebuild.

**The Flow:**
1. App starts → DivineApp builds
2. First frame renders  
3. Post-frame callback → `_initializeServices()` called (main.dart:348-355)
4. AuthService.initialize() called (main.dart:381)
5. Auth state changes from `checking` → `authenticating` → `authenticated`
6. StreamController emits events BUT WelcomeScreen doesn't rebuild
7. Button never appears because screen is stuck showing old state

**Solution Direction:**
Need to make WelcomeScreen reactive to auth state stream changes, not just the provider instance. Could use:
- StreamProvider for authStateStream
- ref.listen to auth state stream
- Or make AuthService a ChangeNotifier again

Let me verify the hypothesis by checking similar patterns in the codebase.
