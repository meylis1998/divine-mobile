{
  "embedding": [
    -0.10483338683843613,
    -0.04907003417611122,
    0.004353443626314402,
    -0.009446850046515465,
    0.035819243639707565,
    -0.04055842384696007,
    0.019756846129894257,
    0.010341320186853409,
    -0.003791575552895665,
    0.06500271707773209,
    0.013515133410692215,
    0.023864930495619774,
    0.003069055499508977,
    0.022134777158498764,
    -0.01737307570874691,
    0.03479422256350517,
    0.050343021750450134,
    -0.06796708703041077,
    -0.06196343153715134,
    0.03704618290066719,
    0.01751278154551983,
    0.00846843235194683,
    0.055357545614242554,
    0.05240049958229065,
    -0.011911778710782528,
    -0.03501864895224571,
    -0.06680465489625931,
    -0.12566819787025452,
    -0.04890592768788338,
    0.0003588859108276665,
    0.014497054740786552,
    0.04135403037071228,
    -0.1564403623342514,
    -0.028680171817541122,
    -0.027336150407791138,
    0.05129833519458771,
    -0.07136929780244827,
    -0.024379922077059746,
    -0.06854686886072159,
    -0.023577269166707993,
    0.0216793492436409,
    0.044179413467645645,
    -0.08292274177074432,
    0.027271272614598274,
    0.008857247419655323,
    -0.059948306530714035,
    0.00040956944576464593,
    -0.0026292288675904274,
    0.0020571232307702303,
    -0.01704428903758526,
    -0.029567450284957886,
    0.06701460480690002,
    0.0005502540152519941,
    -0.003950182348489761,
    0.09869933128356934,
    0.026659414172172546,
    0.05223455652594566,
    0.03667309507727623,
    -0.029959402978420258,
    0.04862957447767258,
    0.037102241069078445,
    -0.031072255223989487,
    -0.028783202171325684,
    -0.06946921348571777,
    0.013134184293448925,
    0.04872274398803711,
    0.05559080094099045,
    -0.011730536818504333,
    0.0806540846824646,
    0.025762788951396942,
    -0.06539326906204224,
    0.09553681313991547,
    -0.018373368307948112,
    -0.005555094685405493,
    -0.017550509423017502,
    -0.020616261288523674,
    0.004039816092699766,
    -0.015146116726100445,
    -0.002930121263489127,
    -0.11914835125207901,
    -0.018142297863960266,
    -0.04758724570274353,
    0.02717730775475502,
    -0.012297691777348518,
    0.07531826943159103,
    0.014921226538717747,
    0.02499249018728733,
    -0.06491633504629135,
    0.05864066258072853,
    0.011673345230519772,
    0.03658013045787811,
    0.007623332552611828,
    0.016222553327679634,
    0.06717365980148315,
    0.048553716391325,
    0.04235846549272537,
    0.05868728086352348,
    0.04398505017161369,
    -0.03620597720146179,
    0.05438212677836418,
    0.022930851206183434,
    0.06271995604038239,
    -0.025751378387212753,
    0.07206431776285172,
    0.010799381881952286,
    -0.03113081492483616,
    -0.01429970096796751,
    -0.006267358548939228,
    -0.08204784244298935,
    -0.026274792850017548,
    0.008512970991432667,
    -0.018933037295937538,
    0.01867535710334778,
    -0.015748903155326843,
    0.02664535865187645,
    0.0019292514771223068,
    -0.07439888268709183,
    -0.027507368475198746,
    -0.004560750909149647,
    0.063064806163311,
    0.12264572829008102,
    0.015960874035954475,
    0.020864473655819893,
    -0.03443625569343567,
    0.04895329475402832,
    0.049530692398548126,
    0.03432361036539078,
    4.4701585297054713e-33,
    0.04821372032165527,
    -0.06023283302783966,
    -0.05088474601507187,
    0.05978403985500336,
    -0.003470959607511759,
    0.02377946488559246,
    -0.01530900876969099,
    0.020531799644231796,
    -0.022488482296466827,
    -0.06569623947143555,
    0.032126788049936295,
    -0.07553669065237045,
    -0.047692425549030304,
    -0.04793809726834297,
    0.04246025159955025,
    -0.08311241120100021,
    0.10133207589387894,
    0.026062136515975,
    0.031543947756290436,
    0.007656417787075043,
    0.052608929574489594,
    -0.008176145143806934,
    -0.06862945109605789,
    -0.04579123109579086,
    0.022992653772234917,
    0.0578031949698925,
    -0.004620239604264498,
    0.056433502584695816,
    -0.021710533648729324,
    0.024958845227956772,
    0.0012946831993758678,
    -0.009080680087208748,
    -0.019654788076877594,
    0.027404652908444405,
    0.0006387234898284078,
    -0.057269368320703506,
    -0.0685034692287445,
    -0.022933397442102432,
    -0.07752552628517151,
    -0.09162420779466629,
    -0.04162118211388588,
    0.05149318650364876,
    -0.11229129880666733,
    0.010629851371049881,
    -0.02532234787940979,
    -0.1479981690645218,
    -0.055377982556819916,
    0.026478692889213562,
    0.007942252792418003,
    0.015863778069615364,
    -0.003414697013795376,
    0.02228628657758236,
    0.01604628376662731,
    -0.05957232788205147,
    -0.035579659044742584,
    0.03518965467810631,
    0.035071924328804016,
    -0.08125022798776627,
    -0.002903916407376528,
    -0.0037113698199391365,
    -0.036238208413124084,
    -0.04888582229614258,
    -0.045402660965919495,
    -0.04784315824508667,
    0.028257623314857483,
    0.009466837160289288,
    -0.033700715750455856,
    -0.01868501864373684,
    0.03770238533616066,
    -0.0427604541182518,
    -0.04235658422112465,
    0.005668851546943188,
    0.09424590319395065,
    -0.012270084582269192,
    -0.004569861106574535,
    0.017984693869948387,
    -0.05385584011673927,
    0.006813960149884224,
    -0.16541698575019836,
    -0.06768552958965302,
    0.04921046644449234,
    -0.045219168066978455,
    -0.06629285216331482,
    0.06173655390739441,
    0.008316520601511002,
    0.0008224561461247504,
    0.054427362978458405,
    -0.05830996856093407,
    -0.0688524916768074,
    0.09948579967021942,
    0.030393853783607483,
    0.022850722074508667,
    0.10792002826929092,
    -0.052486494183540344,
    -0.04141264036297798,
    -5.680278168657183e-33,
    -0.006293154321610928,
    -0.02993668243288994,
    -0.05920153111219406,
    -0.012534638866782188,
    0.039687369018793106,
    -0.045263588428497314,
    -0.025224318727850914,
    0.0426778718829155,
    0.00428570993244648,
    -0.11263106018304825,
    -0.1156315803527832,
    0.08378920704126358,
    0.029320448637008667,
    0.010873024351894855,
    -0.027710719034075737,
    0.06632313877344131,
    0.04815877601504326,
    -0.07986770570278168,
    -0.020741242915391922,
    0.009435649029910564,
    0.03026421368122101,
    0.05408705398440361,
    0.038089871406555176,
    -0.01701889932155609,
    -0.026959212496876717,
    0.05534558743238449,
    0.022098755463957787,
    0.02160005085170269,
    0.0474574975669384,
    -0.08702849596738815,
    0.12863270938396454,
    -0.032644253224134445,
    -0.0896095335483551,
    0.06813691556453705,
    0.0291645135730505,
    -0.05077343434095383,
    0.009415995329618454,
    -0.018541809171438217,
    -0.09190904349088669,
    -0.03677138686180115,
    0.18821144104003906,
    0.03485247120261192,
    -0.026296978816390038,
    -0.01997869834303856,
    0.05877584591507912,
    -0.040673937648534775,
    0.04830935224890709,
    -0.01904410496354103,
    -0.0438116118311882,
    -0.008167466148734093,
    0.018816348165273666,
    -0.09608207643032074,
    0.024749277159571648,
    0.03409494459629059,
    0.02779543027281761,
    0.007332766894251108,
    0.08499535173177719,
    0.0032743564806878567,
    0.06384067237377167,
    -0.04480460658669472,
    0.058899570256471634,
    -0.01867959462106228,
    -0.052663009613752365,
    0.0036366896238178015,
    0.015505685470998287,
    -0.020807011052966118,
    0.009502745233476162,
    0.0010508614359423518,
    0.08804573863744736,
    0.010353856720030308,
    0.05839305743575096,
    0.04862062633037567,
    -0.07427745312452316,
    -0.044543225318193436,
    0.10058567672967911,
    0.04496890306472778,
    -0.04170108586549759,
    -0.04172440990805626,
    -0.0224472489207983,
    0.03895356506109238,
    -0.09467823058366776,
    -0.028003498911857605,
    -0.032743342220783234,
    -0.05845014750957489,
    0.008943907916545868,
    -0.04649873077869415,
    -0.001371803693473339,
    0.06946229189634323,
    0.056333307176828384,
    -0.05262730270624161,
    -0.040720243006944656,
    -0.05413283035159111,
    -0.03209709748625755,
    0.03073553927242756,
    0.008211690001189709,
    -5.616007925368649e-8,
    -0.025101840496063232,
    0.020887671038508415,
    -0.03420097380876541,
    0.07260584831237793,
    0.10721197724342346,
    -0.08431575447320938,
    0.06269422173500061,
    -0.016073741018772125,
    -0.01072547398507595,
    0.04173022136092186,
    0.03159381076693535,
    0.026281028985977173,
    0.012007824145257473,
    -0.03930896520614624,
    0.056485433131456375,
    -0.07391919940710068,
    0.0006268939469009638,
    0.006303469184786081,
    -0.08855551481246948,
    -0.0652451440691948,
    -0.061822205781936646,
    0.00040245900163426995,
    -0.0802856907248497,
    -0.011333025060594082,
    -0.03630229830741882,
    -0.039237745106220245,
    0.08892986923456192,
    -0.013319959864020348,
    0.004008159972727299,
    -0.046366624534130096,
    -0.062397755682468414,
    0.002473051892593503,
    0.054895222187042236,
    -0.09221390634775162,
    -0.059006575495004654,
    0.03381766006350517,
    0.12074528634548187,
    0.03609729930758476,
    0.1451251208782196,
    0.07106204330921173,
    0.025419684126973152,
    0.03819310665130615,
    0.043626971542835236,
    0.04906265437602997,
    -0.0031609118450433016,
    -0.021193265914916992,
    0.005618587601929903,
    0.00397997722029686,
    0.07407969981431961,
    -0.012188319116830826,
    -0.055442459881305695,
    0.004374049603939056,
    -0.07879248261451721,
    -0.0012753392802551389,
    -0.01092387456446886,
    -0.00603388762101531,
    0.02072555385529995,
    -0.04439235478639603,
    0.010763348080217838,
    -0.009695598855614662,
    0.07359840720891953,
    -0.04005346819758415,
    0.004088494926691055,
    0.040465015918016434
  ],
  "text": "Successfully fixed \"Cannot use Ref after disposed\" crashes in commentsProvider and fetchProfileStatsProvider.\n\n### Issue Summary\n- **240 events, 126 users affected**\n- **Type**: NON_FATAL but **breaks UI** (comments fail to load, stats show stale data)\n- **Root Cause**: Accessing `ref` or `state` after async gaps without checking `ref.mounted`\n\n### Affected Providers\n\n**1. CommentsProvider** (`lib/providers/comments_provider.dart`)\n- **Line 120**: Stream listener updating state without mounted check\n- **Line 163**: `Future.delayed` (3 seconds) updating state after provider disposed\n- **Line 133**: Error handler updating state without mounted check\n\n**2. FetchProfileStatsProvider** (`lib/providers/profile_stats_provider.dart`)\n- **Line 104**: After `await subscribeToUserVideos()`\n- **Line 107**: After `await getFollowerStats()`\n- **Line 132**: After `await _cacheProfileStats()`\n\n### Fix Strategy\n\nAdded `ref.mounted` checks after EVERY async gap:\n1. Stream listener callbacks\n2. Future.delayed callbacks\n3. After every `await` statement\n4. Error handlers\n\n### Code Pattern\n\n```dart\n// Before (CRASH)\nawait someAsyncOperation();\nstate = newState; // CRASH if provider disposed during await\n\n// After (SAFE)\nawait someAsyncOperation();\nif (!ref.mounted) {\n  Log.debug('Provider disposed...');\n  return; // or throw StateError\n}\nstate = newState; // Safe - provider still alive\n```\n\n### Files Modified\n- `lib/providers/comments_provider.dart`: Added 3 ref.mounted checks\n- `lib/providers/profile_stats_provider.dart`: Added 3 ref.mounted checks\n\n### Why This Breaks UI\n\n**CommentsProvider**:\n- Comments screen opens\n- Starts loading comments\n- User navigates away quickly (< 3 seconds)\n- Provider disposes\n- Future.delayed fires → tries to update disposed state\n- Result: Comment loading fails silently, users see empty comments\n\n**ProfileStatsProvider**:\n- Profile screen loads stats\n- Awaits video subscription, follower count\n- User navigates away mid-load\n- Provider disposes\n- Async operations complete → try to return/cache stats\n- Result: Stats don't update, shows stale/0 counts\n\n### Testing Impact\n\nThis fix prevents:\n1. Silent failures in comments loading\n2. Stale profile stats displays\n3. Error toasts/snackbars from disposed provider access\n4. UI freezes from state update errors",
  "sections": [
    "Project Notes",
    "Riverpod Disposed Ref Crash Fix"
  ],
  "timestamp": 1763478023815,
  "path": "/Users/rabble/code/andotherstuff/openvine/.private-journal/2025-11-18/07-00-23-815009.md"
}